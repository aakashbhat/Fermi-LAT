\section{Conclusions}
\lb{sec:conclusions}

In this paper we determine the probabilities of classification of sources in the 3FGL and 4FGL-DR2 \Fermi-LAT catalogs
into two (AGNs and pulsars) and three (AGNs, pulsars, and other sources) classes.
The probabilities are calculated with 8 different ML methods: RF, BDT, LR and NN -- each algorithm with and without oversampling during training.
The algorithms were trained and tested with associated sources.
We optimized meta-parameters of the algorithms, such as the depth of the trees, the number of trees, the number of neurons, etc. to avoid any overfitting of data while providing a good accuracy of classification.
The testing accuracies of classification of associated sources in the 3FGL catalog for the four algorithms in the 2-class case without (with) oversampling are about  97\% (between 93\% and 97\%).

We have also checked the accuracy of classification by selecting unassociated sources in 3FGL, which have associations in 4FGL-DR2.
If we take the 4FGL-DR2 associations as the true classes, then the accuracies of classification in this subset of sources 
without (with) oversampling are between 90\% and 91\% (85\% and 92\%).
Most of misclassified sources in this comparison have spectral parameters in 3FGL which are typical of the other class (Fig. \ref{fig:3FGL_vs_4FGL_classes}), i.e.,  the misclassification can be due to problems with reconstructing the spectrum of the sources.
In the 3-class classification, the testing accuracies for the 3FGL catalog are between 92\% and 94\% (both with and without oversampling), while comparison with 4FGL-DR2 give accuracy between 82\% and 85\%. For the 4FGL-DR2 classifications, the testing accuracy is between 90\% and 93\% (both with and without oversampling). If one takes into account that all other sources are misclassified in the 2-class case, then the 3-class case provides an improvement in accuracy of 1\% to 5\%.

We have created four catalogs with probabilistic classifications of sources: based on 3FGL and on 4FGL-DR2 with 2- and 3-class classifications.
For each source and for each class we report class probabilities for each of the eight ML methods (with and without oversampling). 
We also provide individual standard deviations for all classification probabilities by using sample average over selection of training and testing datasets.
We report the classification probabilities not only for the unassociated sources, but also for the associated ones, which can be used to find outliers.
The full probabilistic catalogs for 2- and 3-class classifications of the 3FGL and 4FGL-DR2 catalogs are available online \citep{SOM_material}.
An advantage of such probabilistic classification is that a threshold on probability for selecting, e.g., pulsar candidates, can be chosen by the user based on their needs.
For example, in a search for new pulsars, one can select a low threshold in order to avoid missing possible pulsars.
In a derivation of an average property of the class, e.g., spectral index or cutoff energy, one can select a high threshold in order to avoid contamination from the other classes.

We discuss two examples of applications of probabilistic catalogs: determination of most likely classes of unassociated sources (which can be used for searches of new class members, such as AGNs or pulsars) and population studies using class probabilities including both associated and unassociated sources.
For the determination of the candidate classes of unassociated sources we use two conditions: agreement among algorithms, i.e., each algorithm predicts the same class as the most likely for a source, and that the sum of probabilities for the 8 classification methods is above 7.
In order to evaluate the performance of these classification conditions, we estimate the precision and recall using associated sources and test the estimations using unassociated 3FGL sources, which have associations in the 4FGL-DR2 catalog.
We find that the expected testing precision for the AGNs (pulsars) is above about 97\% (80\%) for 2- and 3-class classification of both 3FGL and 4FGL-DR2 catalogs. The testing precision for the OTHER sources in the 3-class classification is between 75\% and 85\%.
This precision however drops during the comparison of unassociated 3FGL sources with 4FGL-DR2 associations, where it is estimated to be about 93\% (70\%) for AGNs (pulsars), which is significantly smaller than the precision determined from the probabilistic classes of the associated sources.
We notice that many misclassified sources in the 3FGL versus 4FGL-DR2 comparison (Fig. \ref{fig:3FGL_vs_4FGL_classes}) are outside of the expected class domains, if we use 4FGL-DR2 features instead of the 3FGL features. It shows that in many cases such misclassification is due to errors or uncertainties in the input data rather than issues in the classification methods. Such errors in the input data provide an irreducible uncertainty in the analysis. We use the all-algorithms-agree method for the general assignment of the candidate classes to the sources (for convenience we add these classes in the catalogs) and also to create a list of 29 pulsar candidates based on unassociated sources classified as pulsars by all algorithms both in 3FGL and 4FGL-DR2 catalogs using 2-class classification.
We find that the expected precision for the ``sum of probabilities above 7'' condition is larger than the ``all-methods-agreement'' condition (albeit at the expense of generally smaller recall), thus the ``sum of probabilities above 7'' condition is stricter.
In particular, all PSR candidate sources in 3FGL satisfying this condition are associated to pulsars in 4FGL-DR2, while there are no OTHER sources in 3FGL satisfying this condition. In the 3-class classification based on the 4FGL-DR2 catalog there are 6 pulsar candidates and 30 OTHER sources candidates among unassociated sources satisfying  the ``sum of probabilities above 7'' condition. 
We report these sources in Tables \ref{tab:psr_candidates_3class} and \ref{tab:other_candidates_3class} respectively (digital versions of the tables are available in the supplementary online materials \citep{SOM_material}). We discuss possible associations of the pulsar candidates with pulsars from Parkes survey \citep{Camilo2015} and OTHER sources candidates with sources in Simbad database.

As the second example of the application of the probabilistic catalogs, we perform population studies using class probabilities both for associated and unassociated sources.
In particular we derive the expected number of sources in the catalog as a function of their flux.
As a consistency check, we compare the counts of associated sources to the sums of probabilities for the associated sources.
We find that correcting for the contribution of other sources in the 2-class case plays an important role for the estimation of the expected number of sources in a particular class.
We find the total expected number of AGNs and pulsars in the 3FGL and 4FGL catalogs by adding the class probabilities for the unassociated sources in the 2- and 3-class cases to the source counts of associated sources and correcting in the 2-class case for the contribution of other classes in the unassociated sources.
In particular, we find that the total expected number of pulsars is about two times larger than the number of associated pulsars.

We also plot the counts of associated sources and the expected numbers of AGNs, pulsars, and other sources among unassociated sources
as a function of Galactic latitude and longitude.
We find that the number of associated AGNs is decreasing towards low latitudes, while the expected number of AGNs among unassociated sources is increasing, so that the sum of the two is relatively uniform, as expected for extragalactic sources.

We perform the checks of the classification probabilities using reliability diagrams in Appendix \ref{sec:reliability}. 
We find that the performance of the 3-class classification is similar to the 2-class classification, if we take into account only AGNs and PSRs in the 2-class case. For all associated sources, the 2-class classification overestimates the number of pulsars due to the presence of the
other sources, while in the 3-class classification case the other sources are included in the model and the reliability diagrams are reasonably close to the perfect calibration line.

\subsection*{Acknowledgements}

The authors would like to thank Jean Ballet, Isabelle Grenier, Pablo Saz Parkinson, and the anonymous referee for valuable comments and suggestions.
The work of DM was in part supported by BMBF under the ErUM-Data project ``Innovative Digital Technologies for Research on Universe and Matter'' (grant number 05H18WERC1) and by DFG grant MA 8279/2-1.
We would like to acknowledge the use of the following software:
Astropy \citep[\url{http://www.astropy.org},][]{2013A&A...558A..33A}, 
matplotlib \citep{Hunter:2007}, 
scikit-learn [\url{https://scikit-learn.org/stable/about.html}], 
TOPCAT \citep{2005ASPC..347...29T}, and Imbalanced-learn \cite{JMLR:v18:16-365}.
This research has also made use of the SIMBAD database,
operated at CDS, Strasbourg, France \citep{2000A&AS..143....9W}.